return function(Window)
    local PlayerTab = Window:CreateTab("Player", "users")
    
    -- Movement Section
    PlayerTab:CreateSection("Movement Settings")

    -- Walkspeed System
    local CurrentWalkspeed = 16
    local WalkspeedEnabled = false

    local function UpdateWalkspeed()
        local character = game.Players.LocalPlayer.Character
        if character and character:FindFirstChildOfClass("Humanoid") then
            character.Humanoid.WalkSpeed = WalkspeedEnabled and CurrentWalkspeed or 16
        end
    end

    -- Create the toggle first
    local Toggle = PlayerTab:CreateToggle({
        Name = "Enable Walkspeed",
        CurrentValue = WalkspeedEnabled,
        Flag = "WalkspeedToggle",
        Callback = function(Value)
            WalkspeedEnabled = Value
            UpdateWalkspeed()
        end
    })

    -- Then create the slider
    PlayerTab:CreateSlider({
        Name = "Walkspeed Value",
        Range = {16, 200},
        Increment = 1,
        Suffix = "studs/s",
        CurrentValue = CurrentWalkspeed,
        Flag = "WalkspeedSlider",
        Callback = function(Value)
            CurrentWalkspeed = Value
            if Toggle.CurrentValue then  -- Reference the toggle's current value directly
                UpdateWalkspeed()
            end
        end
    })

    -- Handle character changes
    local function CharacterAdded(character)
        task.wait(0.5)
        if Toggle.CurrentValue then
            UpdateWalkspeed()
        end
    end

    game.Players.LocalPlayer.CharacterAdded:Connect(CharacterAdded)
    if game.Players.LocalPlayer.Character then
        CharacterAdded(game.Players.LocalPlayer.Character)
    end
end
